#!/bin/bash
set -e

# ---------------------------------------------
# –°–∫—Ä–∏–ø—Ç: join-swarm.sh
# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
# –ü–æ–¥–∫–ª—é—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é –º–∞—à–∏–Ω—É –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É Docker Swarm-–∫–ª–∞—Å—Ç–µ—Ä—É
# –≤ —Ä–æ–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏–ª–∏ –≤–æ—Ä–∫–µ—Ä–∞, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞.
#
# üìå –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –Ω–∞ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–º swarm-—É–∑–ª–µ (manager), –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
#   ‚ñ∏ –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è worker:
#       docker swarm join-token worker
#
#   ‚ñ∏ –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è manager:
#       docker swarm join-token manager
#
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `docker swarm join --token ...` –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –µ—ë –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–∞.
# ---------------------------------------------

echo "üîó –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É Docker Swarm..."

read -rp "üåê –í–≤–µ–¥–∏—Ç–µ IP-–∞–¥—Ä–µ—Å —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ (manager) —É–∑–ª–∞: " MANAGER_IP
read -rp "üîë –í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω (worker –∏–ª–∏ manager): " TOKEN

docker swarm join --token "$TOKEN" "$MANAGER_IP:2377"

echo "‚úÖ –£–∑–µ–ª —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –∫–ª–∞—Å—Ç–µ—Ä—É."
